<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0f172a;font-family:Arial,sans-serif}
#loader{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;color:white;text-align:center;padding:20px}
.spin{width:44px;height:44px;border:4px solid rgba(255,255,255,.2);border-top-color:#22c55e;border-radius:50%;animation:sp .7s linear infinite;margin-bottom:18px}
@keyframes sp{to{transform:rotate(360deg)}}
#msg{font-size:18px;font-weight:bold}
#sub{font-size:13px;color:rgba(255,255,255,.5);margin-top:8px}
#game-frame{display:none;width:100%;height:100%;border:none}
</style>
</head>
<body>
<div id="loader">
    <div class="spin"></div>
    <div id="msg">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    <div id="sub"></div>
</div>
<iframe id="game-frame"></iframe>
<script>
(function(){
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä—è–º–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
    if(window.self===window.top && location.protocol!=='file:' && location.hostname!=='localhost'){
        document.body.innerHTML='<h1 style="padding:40px;text-align:center;color:white">–û—Ç–∫—Ä–æ–π—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ Genially.</h1>';
        return;
    }

    // 1. –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ —Å—Å—ã–ª–∫–∏
    const params = new URLSearchParams(window.location.search);
    const gameId = params.get('id');

    if(!gameId){
        document.getElementById('msg').textContent='–û—à–∏–±–∫–∞: –Ω–µ—Ç ID –∏–≥—Ä—ã';
        return;
    }

    // 2. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å (–æ–±—Ä–∞—Ç–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏!)
    const url = `https://vera422.github.io/texts/data/${gameId}.json`;

    var tries = 0;

    function load(){
        document.getElementById('sub').textContent = '–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';

        // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        fetch(url).then(function(res){
            if(res.status === 404){
                tries++;
                if(tries < 15){
                    document.getElementById('sub').textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞... (' + (tries*5) + ' —Å–µ–∫)';
                    setTimeout(load, 5000);
                    return null;
                }
                document.getElementById('msg').textContent = '–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
                document.getElementById('sub').textContent = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ';
                return null;
            }
            if(!res.ok) throw new Error('–û—à–∏–±–∫–∞ ' + res.status);
            return res.json();
        }).then(function(cfg){
            if(!cfg) return;
            // 4. –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã —Å –∫–æ–Ω—Ñ–∏–≥–æ–º cfg
            var html = buildGame(cfg);
            document.getElementById('loader').style.display = 'none';
            var f = document.getElementById('game-frame');
            f.style.display = 'block';
            f.srcdoc = html;
        }).catch(function(e){
            tries++;
            if(tries < 15){
                document.getElementById('sub').textContent = '–ü–æ–≤—Ç–æ—Ä...';
                setTimeout(load, 5000);
            } else {
                document.getElementById('msg').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('sub').textContent = e.message || '';
            }
        });
    }

    load();

    // =====================================================
    // –°–¢–†–û–ò–ú –ü–û–õ–ù–£–Æ –ò–ì–†–£ –ò–ó JSON-–ö–û–ù–§–ò–ì–ê
    // =====================================================
    function buildGame(c){
        var title=c.title||'GAME',welcomeText=c.welcomeText||'–ì–æ—Ç–æ–≤—ã?',startBtnText=c.startBtnText||'–°–¢–ê–†–¢!',retryBtnText=c.retryBtnText||'–ï—â—ë —Ä–∞–∑';
        var victoryText=c.victoryText||'–ü–û–ë–ï–î–ê! üéâ',victoryMsg=c.victoryMsg||'–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!',gameoverText=c.gameoverText||'–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê üò¢';
        var lang=c.lang||'ru',enableTimer=c.enableTimer!==false,enableCd=c.enableCd!==false,showWatermark=!!c.showWatermark;
        var lives=c.lives||5,timerDur=c.timerDur||15,ansFont=c.ansFont||22,heroSize=c.heroSize||100,heroV=c.heroV||70;
        var colBorder=c.colBorder||'#6ab04c',colGlow=c.colGlow||'#ffffff',colTimer=c.colTimer||'#eb4d4b',colText=c.colText||'#ffffff';
        var victEff=c.victEff||'fireworks',pDir=c.pDir||'down',gpSize=c.gpSize||100,gpSpeed=c.gpSpeed||100,gpCount=c.gpCount||100;
        var imgHero=c.imgHero||'',imgPlatform=c.imgPlatform||'',imgBg=c.imgBg||'',imgLife=c.imgLife||'',imgVictHero=c.imgVictHero||'',imgCustP=c.imgCustP||'';
        var sndStart=c.sndStart||'',sndJump=c.sndJump||'',sndShock=c.sndShock||'',sndLose=c.sndLose||'',sndWin=c.sndWin||'',sndLevel=c.sndLevel||'',sndCountdown=c.sndCountdown||'';
        var levelsBank=c.levels||{},levelsMeta=c.levelsMeta||{};

        var escH=function(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');};

        var countdownHTML=enableCd?'<div id="countdown-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:3000;justify-content:center;align-items:center;"><div id="countdown-text" style="font-size:140px;color:'+colText+';font-weight:900;text-shadow:0 0 30px rgba(0,0,0,.6);font-family:Arial;"></div></div>':'';

        var initCode=enableCd?(
            'var cov=document.getElementById("countdown-overlay");var ctxt=document.getElementById("countdown-text");document.getElementById("overlay").style.display="none";Object.values(sounds).forEach(function(s){if(s){try{s.pause();s.currentTime=0;}catch(e){}}});currentLevel=1;step=0;lives='+lives+';updateLives();createPond();cov.style.display="flex";var csteps=["3","2","1",t.go];var ci=0;if(window._cdTimer)clearTimeout(window._cdTimer);if(sounds.count){sounds.count.currentTime=0;sounds.count.volume=gvol;sounds.count.play().catch(function(){});}function _showCd(){if(ci<csteps.length){ctxt.textContent=csteps[ci];ctxt.classList.remove("count-anim");void ctxt.offsetWidth;ctxt.classList.add("count-anim");ci++;window._cdTimer=setTimeout(_showCd,1000);}else{if(sounds.count){sounds.count.pause();sounds.count.currentTime=0;}cov.style.display="none";frog.style.opacity=1;startGameLogic();}}_showCd();'
        ):(
            'currentLevel=1;step=0;lives='+lives+';updateLives();createPond();document.getElementById("overlay").style.display="none";frog.style.opacity=1;startGameLogic();'
        );

        return '<!DOCTYPE html>\n<html lang="'+lang+'">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0">\n<title>'+escH(title)+'</title>\n<style>\n'+
'*{box-sizing:border-box;margin:0;padding:0}\n'+
':root{--ui:'+colBorder+';--glow:'+colGlow+';--timer:'+colTimer+';--tcol:'+colText+';}\n'+
'html,body{width:100%;height:100%;overflow:hidden;font-family:Arial,sans-serif;'+(imgBg?'background:url("'+imgBg+'") no-repeat center/cover;':'background:#1a5276;')+'}\n'+
'#start-screen{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:3000;display:flex;flex-direction:column;justify-content:center;align-items:center;color:var(--tcol);text-align:center;padding:20px;}\n'+
'#start-screen h1{font-size:clamp(2em,5vw,3.5em);margin-bottom:18px;text-shadow:0 0 20px rgba(0,0,0,.9);}\n'+
'#start-screen p{font-size:clamp(1em,2.5vw,1.6em);margin-bottom:28px;text-shadow:0 0 10px rgba(0,0,0,.8);}\n'+
'#start-btn{padding:18px 56px;font-size:22px;font-weight:bold;background:var(--ui);color:#fff;border:none;border-radius:50px;cursor:pointer;text-transform:uppercase;box-shadow:0 8px 24px rgba(0,0,0,.5);transition:transform .3s,box-shadow .3s;}\n'+
'#start-btn:hover{transform:scale(1.08) translateY(-4px);box-shadow:0 14px 36px rgba(0,0,0,.7);}\n'+
'#ui{position:absolute;top:0;width:100%;z-index:1000;pointer-events:none;}\n'+
'#header{background:var(--ui);color:#fff;padding:9px;text-align:center;font-weight:bold;font-size:clamp(12px,2vw,18px);pointer-events:auto;}\n'+
'#lives-wrap{position:absolute;top:46px;left:16px;display:flex;gap:6px;pointer-events:auto;}\n'+
'.life-icon{width:46px;height:46px;'+(imgLife?'background:url("'+imgLife+'") no-repeat center/contain;':'font-size:28px;line-height:46px;text-align:center;')+'filter:drop-shadow(0 3px 5px rgba(0,0,0,.4));}\n'+
(imgLife?'':'.life-icon::before{content:"\\2764\\FE0F"}\n')+
'#qbox{background:#fff;width:88%;max-width:520px;margin:8px auto;padding:12px 14px;border-radius:16px;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,.3);pointer-events:auto;}\n'+
'#q-text{font-size:clamp(13px,2.5vw,17px);color:#2c3e50;font-weight:bold;line-height:1.4;}\n'+
'.tbar{width:100%;height:7px;background:#dfe6e9;border-radius:4px;margin-top:8px;overflow:hidden;'+(enableTimer?'':'display:none;')+'}\n'+
'#tfill{width:100%;height:100%;background:var(--timer);transition:width .1s linear;}\n'+
'#world{position:absolute;inset:0;padding-top:56px;overflow:hidden;}\n'+
'#pond{position:relative;width:100%;height:100%;overflow:hidden;}\n'+
'.leaf{position:absolute;width:20vw;height:16vw;max-width:180px;max-height:150px;'+(imgPlatform?'background:url("'+imgPlatform+'") no-repeat center/contain;':'background:radial-gradient(circle,#27ae60,#1a7a40);border-radius:50%;')+'display:flex;align-items:center;justify-content:center;opacity:.85;transform:scale(.85);transition:transform .4s,opacity .4s;padding:14px;text-align:center;font-size:'+ansFont+'px;color:#fff;font-weight:bold;text-shadow:1px 1px 3px rgba(0,0,0,.9),-1px -1px 3px rgba(0,0,0,.9);}\n'+
'.leaf.active{opacity:1;transform:scale(1.1);z-index:10;cursor:pointer;filter:drop-shadow(0 0 14px var(--glow));}\n'+
'.leaf.active::after{content:attr(data-letter);position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:#f1c40f;width:22px;height:22px;border-radius:50%;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000;text-shadow:none;}\n'+
'.leaf.active:not([data-letter])::after{display:none;}\n'+
'@keyframes leafBounce{0%{transform:scale(1.1) translateY(0)}30%{transform:scale(1.05) translateY(7px)}60%{transform:scale(1.12) translateY(-3px)}100%{transform:scale(1.1) translateY(0)}}\n'+
'.leaf-landed{animation:leafBounce .5s ease-out;}\n'+
'#frog{opacity:0;position:absolute;width:calc(10vw*'+heroSize+'/100);height:calc(10vw*'+heroSize+'/100);max-width:calc(90px*'+heroSize+'/100);max-height:calc(90px*'+heroSize+'/100);'+(imgHero?'background:url("'+imgHero+'") no-repeat center/contain;':'font-size:calc(50px*'+heroSize+'/100);line-height:1;text-align:center;')+'transform:translate(-50%,-'+heroV+'%) scale(1.15);filter:drop-shadow(0 8px 14px rgba(0,0,0,.5));z-index:999!important;transition:left .6s cubic-bezier(.47,1.21,.58,1),top .6s cubic-bezier(.47,1.21,.58,1),transform .3s;pointer-events:none;}\n'+
(imgHero?'':'#frog::after{content:"\\1F438"}\n')+
'.jumping-frog{filter:drop-shadow(0 28px 18px rgba(0,0,0,.35))!important;transform:translate(-50%,calc(-'+heroV+'% - 20%)) scale(1.4)!important;}\n'+
'@keyframes shock{0%{transform:scale(1.1) translate(2px,2px);filter:brightness(1.6) hue-rotate(180deg)}25%{transform:scale(1.1) translate(-2px,-2px)}50%{transform:scale(1.1) translate(2px,-2px)}75%{transform:scale(1.1) translate(-2px,2px)}100%{transform:scale(1.1) translate(0,0);filter:brightness(1)}}\n'+
'.shock{animation:shock .1s infinite;z-index:10!important;}\n'+
'.splash{position:absolute;border:4px solid rgba(255,255,255,.6);border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;animation:splAni .6s ease-out forwards;z-index:5;}\n'+
'@keyframes splAni{0%{width:0;height:0;opacity:1;border-width:4px}100%{width:150px;height:80px;opacity:0;border-width:1px}}\n'+
'#overlay{position:fixed;inset:0;background:transparent;z-index:2000;display:none;flex-direction:column;justify-content:center;align-items:center;}\n'+
'.vmodal{background:rgba(255,255,255,.95);padding:36px;border-radius:20px;text-align:center;max-width:480px;box-shadow:0 20px 60px rgba(0,0,0,.5);}\n'+
'.vmodal img{max-width:180px;max-height:180px;display:block;margin:0 auto 16px;}\n'+
'.vmodal h1{color:#22c55e;font-size:2.2em;margin:0 0 12px;}\n'+
'.vmodal p{color:#334;font-size:1.1em;margin:0 0 22px;line-height:1.5;}\n'+
'.vmodal button{padding:14px 40px;font-size:17px;background:var(--ui);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:bold;}\n'+
'#gameover-screen{text-align:center;color:var(--tcol);text-shadow:2px 2px 4px rgba(0,0,0,.7);}\n'+
'#gameover-screen h1{font-size:clamp(2em,5vw,3.5em);animation:bounceIn 1s ease-out;margin-bottom:20px;}\n'+
'#gameover-screen button{padding:14px 42px;border-radius:28px;border:none;background:var(--ui);color:#fff;font-size:18px;cursor:pointer;font-weight:bold;}\n'+
'@keyframes bounceIn{0%{opacity:0;transform:scale(.3)}20%{transform:scale(1.1)}40%{transform:scale(.9)}60%{opacity:1;transform:scale(1.03)}80%{transform:scale(.97)}100%{opacity:1;transform:scale(1)}}\n'+
'@keyframes pondSlide{0%{transform:translateY(0);opacity:1}50%{transform:translateY(100vh);opacity:0}51%{transform:translateY(-100vh);opacity:0}100%{transform:translateY(0);opacity:1}}\n'+
'.pond-transition{animation:pondSlide 1.2s ease-in-out;}\n'+
'#fxCanvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2001;pointer-events:none;}\n'+
'#vol-ctrl{position:absolute;top:46px;right:14px;background:rgba(255,255,255,.92);padding:7px 13px;border-radius:22px;display:flex;align-items:center;gap:8px;z-index:2000;pointer-events:auto;box-shadow:0 3px 12px rgba(0,0,0,.2);border:2px solid var(--ui);}\n'+
'#vol-slider{cursor:pointer;accent-color:var(--ui);width:72px;}\n'+
'@keyframes countPulse{0%{transform:scale(.4);opacity:0}50%{transform:scale(1.3);opacity:1}100%{transform:scale(1);opacity:0}}\n'+
'.count-anim{animation:countPulse .9s ease-out forwards;}\n'+
'#brand-logo{position:fixed;bottom:52px;right:12px;width:70px;height:auto;opacity:0.85;z-index:1500;pointer-events:none;'+(showWatermark?'':'display:none;')+'}\n'+
'#copyright{position:fixed;bottom:0;left:0;width:100%;background:rgba(0,0,0,.55);color:rgba(255,255,255,.75);font-size:10px;text-align:center;padding:4px 8px;z-index:1500;pointer-events:none;'+(showWatermark?'':'display:none;')+'}\n'+
'</style>\n</head>\n<body>\n\n'+
'<div id="start-screen"><h1>'+escH(title)+'</h1><p>'+escH(welcomeText)+'</p><button id="start-btn" id="start-btn">'+escH(startBtnText)+'</button></div>\n\n'+
countdownHTML+'\n\n'+
'<div id="ui"><div id="header">'+escH(title)+'</div><div id="lives-wrap"></div><div id="qbox"><div id="q-text"><b>'+escH(welcomeText)+'</b></div><div class="tbar"><div id="tfill"></div></div></div></div>\n\n'+
'<div id="vol-ctrl"><span id="vol-icon">üîä</span><input type="range" id="vol-slider" min="0" max="1" step="0.1" value="0.5"></div>\n\n'+
'<img id="brand-logo" src="https://raw.githubusercontent.com/vivanova288-boop/froggy-quest-builder-v3/main/logo_transparent_clean.png" alt="">\n'+
'<div id="copyright">\\u00a9 2026 Vera\\u0027s Interactive English Zone...</div>\n\n'+
'<div id="world"><div id="pond"><div id="frog"></div></div></div>\n\n'+
'<div id="overlay"><div class="vmodal" id="victory-modal" style="display:none;">'+(imgVictHero?'<img src="'+imgVictHero+'" alt="">':'')+'<h1 id="v-title"></h1><p id="v-msg"></p><button onclick="initGame()">'+escH(retryBtnText)+'</button></div><div id="gameover-screen" style="display:none;"><h1 id="go-text"></h1><button onclick="initGame()">'+escH(retryBtnText)+'</button></div><canvas id="fxCanvas"></canvas></div>\n\n'+
'<script>\n'+
'var LB='+JSON.stringify(levelsBank)+';\nvar LEVELS_META='+JSON.stringify(levelsMeta)+';\n'+
'var TDUR='+timerDur+';var ETIMER='+enableTimer+';var VTXT='+JSON.stringify(victoryText)+';var VMSG='+JSON.stringify(victoryMsg)+';var GOTXT='+JSON.stringify(gameoverText)+';var VEFF='+JSON.stringify(victEff)+';var PDIR='+JSON.stringify(pDir)+';var CPIMG='+JSON.stringify(imgCustP)+';var GPS='+gpSize+'/100;var GPSP='+gpSpeed+'/100;var GPC='+gpCount+';\n'+
'var TR={ru:{level:"–£–†–û–í–ï–ù–¨",question:"–í–æ–ø—Ä–æ—Å",outOfTime:"–í—Ä–µ–º—è –≤—ã—à–ª–æ!",go:"–í–ü–ï–†–Å–î!"},,en:{level:"LEVEL",question:"Question",outOfTime:"Out of time!",go:"GO!"},de:{level:"STUFE",question:"Frage",outOfTime:"Zeit ab!",go:"LOS!"}};\n'+
'var t=TR["'+lang+'"];\n'+
'var currentLevel=1,step=0,lives='+lives+',questions=[],timer=null,lastLeaf=null,gvol=0.5,jumping=false;\n'+
'function getLevelTitle(lvl){var m=LEVELS_META[lvl];if(m&&m.name)return m.name;return t.level+" "+lvl;}\n'+
'function applyLevelAssets(lvl){var m=LEVELS_META[lvl]||{};if(m.bg){document.body.style.background="url("+JSON.stringify(m.bg)+") no-repeat center/cover";}else{document.body.style.background="";}var fe=document.getElementById("frog");if(m.hero){fe.style.backgroundImage="url("+JSON.stringify(m.hero)+")";fe.style.backgroundRepeat="no-repeat";fe.style.backgroundSize="contain";fe.style.backgroundPosition="center";}else{fe.style.backgroundImage="";}var pi=m.platform||"";document.querySelectorAll(".leaf").forEach(function(lf){if(pi){lf.style.backgroundImage="url("+JSON.stringify(pi)+")";lf.style.backgroundSize="contain";lf.style.backgroundRepeat="no-repeat";}else{lf.style.backgroundImage="";}});}\n'+
'function mkAudio(src){if(!src)return null;try{return new Audio(src);}catch(e){return null;}}\n'+
'var sounds={start:mkAudio('+JSON.stringify(sndStart)+'),jump:mkAudio('+JSON.stringify(sndJump)+'),shock:mkAudio('+JSON.stringify(sndShock)+'),lose:mkAudio('+JSON.stringify(sndLose)+'),win:mkAudio('+JSON.stringify(sndWin)+'),level:mkAudio('+JSON.stringify(sndLevel)+'),count:mkAudio('+JSON.stringify(sndCountdown)+')};\n'+
'function playSound(s){if(!s)return;try{s.currentTime=0;s.volume=gvol;s.play();}catch(e){}}\n'+
'document.getElementById("vol-slider").addEventListener("input",function(e){gvol=parseFloat(e.target.value);document.getElementById("vol-icon").textContent=gvol===0?"üîá":"üîä";});\n'+
'var pond=document.getElementById("pond"),frog=document.getElementById("frog");\n'+
'var fxC=document.getElementById("fxCanvas"),ctx=fxC.getContext("2d");\n'+
'function szC(){fxC.width=innerWidth;fxC.height=innerHeight;}window.addEventListener("resize",szC);szC();\n'+
'function hideStart(){document.getElementById("start-screen").style.display="none";initGame();}document.getElementById("start-btn").addEventListener("click",hideStart);document.getElementById("start-btn").addEventListener("touchend",function(e){e.preventDefault();hideStart();});\n'+
'function createPond(){pond.querySelectorAll(".leaf").forEach(function(l){l.remove();});var R=7,C=5;var pi=LEVELS_META[currentLevel]&&LEVELS_META[currentLevel].platform||"";for(var r=0;r<R;r++)for(var c=1;c<4;c++){var l=document.createElement("div");l.className="leaf";if(pi){l.style.backgroundImage="url("+JSON.stringify(pi)+")";l.style.backgroundSize="contain";l.style.backgroundPosition="center";l.style.backgroundRepeat="no-repeat";}var cw=100/(C-1),off=(r%2===0)?0:cw/2,lp=50+((c*cw+off)-62.5)*1.2;l.style.left=lp+"%";l.style.top=((r/(R-1))*65+5)+"%";l.id="leaf-"+r+"-"+c;pond.appendChild(l);}}\n'+
'function initGame(){pond.classList.remove("pond-transition");'+initCode+'}\n'+
'function shuffle(a){var b=[].concat(a);for(var i=b.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var x=b[i];b[i]=b[j];b[j]=x;}return b;}\n'+
'function startGameLogic(){playSound(sounds.start);document.getElementById("header").textContent=getLevelTitle(currentLevel);applyLevelAssets(currentLevel);var qs=shuffle(LB[currentLevel]||[]).slice(0,6);questions=qs.map(function(q){var opts=shuffle([].concat(q.options));return{q:q.q,options:opts,correct:opts.indexOf(q.options[q.correct])};});frog.classList.remove("sink","super-jump","shock");lastLeaf=document.getElementById("leaf-6-2");document.querySelectorAll(".leaf").forEach(function(l){l.classList.remove("active","leaf-landed","shock");});if(lastLeaf)lastLeaf.classList.add("active");frog.style.transition="none";mvFrog(lastLeaf);setTimeout(function(){frog.style.transition="left .6s cubic-bezier(.47,1.21,.58,1),top .6s cubic-bezier(.47,1.21,.58,1),transform .3s";loadLevel();},50);}\n'+
'function updateLives(){var c=document.getElementById("lives-wrap");c.innerHTML="";for(var i=0;i<lives;i++){var d=document.createElement("div");d.className="life-icon";c.appendChild(d);}}\n'+
'function loadLevel(){jumping=false;if(step>=questions.length){var nxt=currentLevel+1;if(LB[nxt]&&LB[nxt].length>0){frog.classList.add("super-jump");playSound(sounds.level);setTimeout(function(){pond.classList.add("pond-transition");setTimeout(function(){currentLevel++;step=0;var qs2=shuffle(LB[currentLevel]||[]).slice(0,6);questions=qs2.map(function(q){var opts=shuffle([].concat(q.options));return{q:q.q,options:opts,correct:opts.indexOf(q.options[q.correct])};});document.getElementById("header").textContent=getLevelTitle(currentLevel);applyLevelAssets(currentLevel);frog.classList.remove("super-jump");frog.style.transition="none";lastLeaf=document.getElementById("leaf-6-2");mvFrog(lastLeaf);setTimeout(function(){pond.classList.remove("pond-transition");frog.style.transition="left .6s cubic-bezier(.47,1.21,.58,1),top .6s cubic-bezier(.47,1.21,.58,1),transform .3s";loadLevel();},50);},600);},400);return;}showEnd(VTXT);return;}document.querySelectorAll(".leaf.active").forEach(function(l){l.classList.remove("active","leaf-landed");l.textContent="";l.onclick=null;delete l.dataset.letter;});if(lastLeaf)lastLeaf.classList.add("active");var q=questions[step];document.getElementById("q-text").innerHTML="<b>"+t.question+" "+(step+1)+":</b> "+q.q;var row=5-step;[1,2,3].forEach(function(c,i){var lf=document.getElementById("leaf-"+row+"-"+c);if(lf){lf.classList.add("active");lf.dataset.letter=String.fromCharCode(65+i);lf.textContent=q.options[i];(function(idx,leaf){lf.onclick=function(){hJump(idx,leaf);};})(i,lf);}});if(ETIMER)startTimer();}\n'+
'function hJump(i,leaf){if(jumping)return;jumping=true;clearInterval(timer);mvFrog(leaf);if(i===questions[step].correct){lastLeaf=leaf;leaf.classList.add("leaf-landed");playSound(sounds.jump);setTimeout(function(){var x=leaf.offsetLeft+leaf.offsetWidth/2,y=leaf.offsetTop+leaf.offsetHeight/2;mkSplash(x,y);},300);setTimeout(function(){step++;jumping=false;loadLevel();},700);}else{playSound(sounds.shock);leaf.classList.add("shock");frog.classList.add("shock");lives--;updateLives();setTimeout(function(){mvFrog(lastLeaf);setTimeout(function(){leaf.classList.remove("shock");frog.classList.remove("shock");},300);if(lives<=0)showEnd(GOTXT);else setTimeout(function(){jumping=false;loadLevel();},400);},150);}}\n'+
'function mkSplash(x,y){var s=document.createElement("div");s.className="splash";s.style.left=x+"px";s.style.top=y+"px";pond.appendChild(s);setTimeout(function(){s.remove();},600);}\n'+
'function mvFrog(leaf){if(!leaf||frog.classList.contains("super-jump"))return;frog.style.zIndex="999";frog.classList.add("jumping-frog");frog.style.left=(leaf.offsetLeft+leaf.offsetWidth/2)+"px";frog.style.top=(leaf.offsetTop+leaf.offsetHeight/2)+"px";setTimeout(function(){frog.classList.remove("jumping-frog");},600);}\n'+
'function startTimer(){var pct=100;clearInterval(timer);timer=setInterval(function(){pct-=(100/(TDUR*10));document.getElementById("tfill").style.width=Math.max(0,pct)+"%";if(pct<=0){clearInterval(timer);onTimeout();}},100);}\n'+
'function onTimeout(){playSound(sounds.shock);frog.classList.add("shock");lives--;updateLives();setTimeout(function(){frog.classList.remove("shock");if(lives<=0)showEnd(GOTXT);else{jumping=false;loadLevel();}},800);}\n'+
'var parts=[],animId=null;\n'+
'function spawnEff(eff){var n=Math.max(1,Math.round(GPC/10));if(eff==="fireworks"){for(var i=0;i<5*n;i++){var ang=Math.random()*Math.PI*2,sp=(Math.random()*5+2)*GPSP;parts.push({x:Math.random()*fxC.width,y:Math.random()*fxC.height*.7,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp,a:1,dec:Math.random()*.03+.01,col:"hsl("+(Math.random()*360)+",100%,50%)",t:"f"});}}else if(eff==="confetti"){for(var i=0;i<n;i++){parts.push({x:Math.random()*fxC.width,y:-20,sz:(Math.random()*10+5)*GPS,vx:(Math.random()*4-2)*GPSP,vy:(Math.random()*5+3)*GPSP,rot:Math.random()*360,rs:(Math.random()*10-5)*GPSP,a:1,col:"hsl("+Math.floor(Math.random()*360)+",100%,50%)",t:"c"});}}else if(eff==="hearts"){for(var i=0;i<n;i++){parts.push({x:Math.random()*fxC.width,y:fxC.height,sz:(Math.random()*28+18)*GPS,vx:(Math.random()*2-1)*GPSP,vy:(Math.random()*-3-1)*GPSP,g:.12*GPSP,rot:Math.random()*360,rs:(Math.random()*4-2)*GPSP,a:Math.random()*.4+.3,hue:Math.floor(Math.random()*60+300),t:"h"});}}else if(eff==="stars"){for(var i=0;i<n;i++){parts.push({x:Math.random()*fxC.width,y:-20,sz:(Math.random()*8+4)*GPS,vy:(Math.random()*3+2)*GPSP,tw:Math.random()*Math.PI*2,a:1,t:"s"});}}}\n'+
'function animLoop(){animId=requestAnimationFrame(animLoop);ctx.clearRect(0,0,fxC.width,fxC.height);parts=parts.filter(function(p){if(p.t==="f"){p.vx*=.99;p.vy*=.99;p.vy+=.05;p.x+=p.vx;p.y+=p.vy;p.a-=p.dec;ctx.save();ctx.globalAlpha=p.a;ctx.beginPath();ctx.arc(p.x,p.y,2,0,Math.PI*2);ctx.fillStyle=p.col;ctx.fill();ctx.restore();}else if(p.t==="c"){p.vy+=.2*GPSP;p.x+=p.vx;p.y+=p.vy;p.rot+=p.rs;if(p.y>fxC.height)p.a-=.02;ctx.save();ctx.globalAlpha=p.a;ctx.translate(p.x,p.y);ctx.rotate(p.rot*Math.PI/180);ctx.fillStyle=p.col;ctx.fillRect(-p.sz/2,-p.sz/2,p.sz,p.sz);ctx.restore();}else if(p.t==="h"){p.vy+=p.g;p.x+=p.vx;p.y+=p.vy;p.rot+=p.rs;if(p.y>fxC.height+50)p.a-=.01;ctx.save();ctx.globalAlpha=p.a;ctx.translate(p.x,p.y);ctx.rotate(p.rot*Math.PI/180);ctx.fillStyle="hsl("+p.hue+",100%,60%)";var s=p.sz;ctx.beginPath();ctx.moveTo(0,s/4);ctx.bezierCurveTo(-s/2,-s/4,-s,s/4,0,s);ctx.bezierCurveTo(s,s/4,s/2,-s/4,0,s/4);ctx.fill();ctx.restore();}else if(p.t==="s"){p.y+=p.vy;p.tw+=.1;if(p.y>fxC.height)p.a-=.02;ctx.save();ctx.globalAlpha=p.a*(Math.sin(p.tw)*.3+.7);ctx.fillStyle="#FFD700";ctx.beginPath();for(var i=0;i<5;i++){var a=(Math.PI*2*i)/5-Math.PI/2;ctx.lineTo(p.x+Math.cos(a)*p.sz,p.y+Math.sin(a)*p.sz);}ctx.closePath();ctx.fill();ctx.restore();}return p.a>0;});if(Math.random()<.1)spawnEff(VEFF);}\n'+
'function stopFx(){cancelAnimationFrame(animId);animId=null;parts=[];ctx.clearRect(0,0,fxC.width,fxC.height);}\n'+
'function showEnd(txt){document.getElementById("overlay").style.display="flex";if(txt===VTXT){document.getElementById("victory-modal").style.display="block";document.getElementById("gameover-screen").style.display="none";document.getElementById("v-title").textContent=VTXT;document.getElementById("v-msg").textContent=VMSG;playSound(sounds.win);if(VEFF!=="none"){fxC.style.display="block";animLoop();setTimeout(stopFx,6000);}}else{document.getElementById("victory-modal").style.display="none";document.getElementById("gameover-screen").style.display="block";document.getElementById("go-text").textContent=GOTXT;playSound(sounds.lose);stopFx();fxC.style.display="none";}}\n'+
'<\/script>\n</body>\n</html>';
    }
})();
</script>
</body>
</html>
