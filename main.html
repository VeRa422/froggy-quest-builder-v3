<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Froggy Quest | Game</title>
    <style>
        /* Стиль для экрана загрузки */
        body { background: #1a5276; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #loader-container { text-align: center; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #game-content { display: none; width: 100%; height: 100%; }
        /* Сюда автоматически подтянутся стили из твоих ассетов */
    </style>
</head>
<body>

    <div id="loader-container">
        <div class="spinner"></div>
        <div id="status-text">Подготовка лилий...</div>
    </div>

    <div id="game-content">
        <canvas id="gameCanvas"></canvas>
    </div>

<script>
    if (window.self === window.top && !window.location.href.includes('localhost')) {
    // Если игру открыли напрямую по ссылке, а не внутри iframe
    document.body.innerHTML = "<h1>Доступ ограничен</h1>";
    throw new Error("Запуск разрешен только внутри образовательных платформ.");
}
// Настройки путей к твоим файлам на GitHub
const BASE_URL = "https://vera422.github.io/froggy-quest-builder-v3/";
const DATA_URL = "https://vera422.github.io/texts/data/";

async function initGame() {
    const params = new URLSearchParams(window.location.search);
    const gameId = params.get('id');

    if (!gameId) {
        document.getElementById('status-text').textContent = "Ошибка: ID игры не найден";
        return;
    }

    try {
        const response = await fetch(`${DATA_URL}${gameId}.json`);
        
        if (response.status === 404) {
            document.getElementById('status-text').textContent = "GitHub обновляет файлы... Пробую еще раз через 5 секунд";
            setTimeout(initGame, 5000); // Ждем и пробуем снова
            return;
        }

        const config = await response.json();
        setupEngine(config);

    } catch (e) {
        console.error(e);
        document.getElementById('status-text').textContent = "Ошибка связи с GitHub. Попробуйте обновить страницу.";
    }
}

function setupEngine(config) {
    document.getElementById('loader-container').style.display = 'none';
    document.getElementById('game-content').style.display = 'block';

    // ВАЖНО: Прописываем звуки из твоего репозитория
    window.gameSounds = {
        jump: new Audio(BASE_URL + "1.mp3"),
        right: new Audio(BASE_URL + "2.mp3"),
        wrong: new Audio(BASE_URL + "3.mp3"),
        win: new Audio(BASE_URL + "4.mp3"), // Тот самый звук в конце
        fail: new Audio(BASE_URL + "5.mp3")
    };

    console.log("Игра загружена! Данные:", config);
    
    // Здесь начинается магия твоей игры (логика из частей 8-9)
    // Если у тебя остались старые функции запуска, вызывай их тут
    alert("Игра готова! Название: " + config.title);
}

// Поехали!
initGame();
</script>
</body>
</html>
