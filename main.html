<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0f172a;font-family:Arial,sans-serif}
#loader{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;color:white;text-align:center;padding:20px}
.spin{width:44px;height:44px;border:4px solid rgba(255,255,255,.2);border-top-color:#22c55e;border-radius:50%;animation:sp .7s linear infinite;margin-bottom:18px}
@keyframes sp{to{transform:rotate(360deg)}}
#msg{font-size:18px;font-weight:bold}
#sub{font-size:13px;color:rgba(255,255,255,.5);margin-top:8px}
#game-frame{display:none;width:100%;height:100%;border:none}
</style>
</head>
<body>
<div id="loader">
    <div class="spin"></div>
    <div id="msg">Загрузка игры...</div>
    <div id="sub"></div>
</div>
<iframe id="game-frame"></iframe>
<script>
(function(){
    if(window.self===window.top && location.protocol!=='file:' && location.hostname!=='localhost'){
        document.body.innerHTML='<h1 style="padding:40px;text-align:center;color:white">Откройте игру через Genially.</h1>';
        return;
    }
    var tries=0;
    function load(){
        var id=new URLSearchParams(location.search).get('id');
        if(!id){document.getElementById('msg').textContent='Нет ID игры';return;}
        var url='https://vera422.github.io/texts/data/'+id+'.html';
        document.getElementById('sub').textContent='попытка '+(tries+1)+'...';
        fetch(url).then(function(r){
            if(r.status===404){
                tries++;
                if(tries<15){
                    document.getElementById('sub').textContent='GitHub обновляется... ('+tries*5+' сек)';
                    setTimeout(load,5000);
                    return null;
                }
                document.getElementById('msg').textContent='Игра не найдена';
                return null;
            }
            if(!r.ok)throw new Error('HTTP '+r.status);
            return r.text();
        }).then(function(html){
            if(!html)return;
            document.getElementById('loader').style.display='none';
            var f=document.getElementById('game-frame');
            f.style.display='block';
            f.srcdoc=html;
        }).catch(function(e){
            tries++;
            if(tries<15){document.getElementById('sub').textContent='Повтор...';setTimeout(load,5000);}
            else{document.getElementById('msg').textContent='Ошибка: '+e.message;}
        });
    }
    load();
})();
</script>
</body>
</html>
